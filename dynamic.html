<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Dynamic Web — Vanduo Framework documentation with lazy-loaded sections. SPA-like experience with no third-party libraries.">
    <meta name="author" content="Vanduo Framework">
    <meta name="keywords"
        content="Vanduo, dynamic web, SPA, lazy load, documentation, vanilla JS, no dependencies">
    <meta name="robots" content="index, follow">
    <title>Dynamic Web - Vanduo Framework</title>
    <link rel="canonical" href="https://vanduo.dev/dynamic.html">
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">
    <link rel="stylesheet" href="./dist/vanduo.min.css">

    <style>
        html { scroll-behavior: smooth; overscroll-behavior-y: none; background-color: var(--bg-primary); }
        body { overscroll-behavior-y: none; }
        .vd-navbar-brand { margin-left: 1rem; }
        .skip-link {
            position: absolute; top: -40px; left: 0;
            background: var(--color-primary); color: var(--color-white);
            padding: 8px; text-decoration: none; z-index: 100;
        }
        .skip-link:focus { top: 0; }
        section {
            padding: 4rem 0; scroll-margin-top: 80px;
            border-bottom: 1px solid var(--border-color);
        }
        section:first-of-type { padding-top: 2rem; }
        section:last-of-type { border-bottom: none; padding-bottom: 0; }
        .demo-card { margin-bottom: 2rem; }
        .vd-footer { padding: var(--footer-padding-y-sm) var(--footer-padding-x) 0; }
        .vd-footer-made-with { margin-top: 1rem; padding: 1rem 0; }
        .vd-footer-bottom { padding: 0.75rem 0 1rem; }
        .vd-tooltip:not(.is-visible) { display: none !important; }
        .demo-title {
            display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem;
            padding-bottom: 0.75rem; border-bottom: 2px solid var(--color-primary);
            font-size: 1.75rem; color: var(--color-primary);
        }
        .demo-card .vd-card-header h3, .demo-card .vd-card-body h3,
        .demo-card .vd-card-body h4, .vd-footer h4 { color: var(--color-primary); }
        .demo-title i { font-size: 1.25em; color: var(--color-primary); }
        .demo-title code { font-size: 0.5em; vertical-align: middle; margin-left: auto; }
        .code-example {
            background: var(--bg-secondary); padding: 1rem; border-radius: var(--btn-border-radius);
            margin-top: 1rem; font-family: var(--font-family-mono);
            font-size: var(--font-size-sm); overflow-x: auto;
        }
        .doc-sidebar {
            position: sticky; top: 70px; height: calc(100vh - 80px);
            overflow: visible; padding-right: 1rem; border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column;
        }
        .doc-sidebar .vd-doc-search {
            flex-shrink: 0; position: sticky; top: 70px; z-index: 2;
            background: var(--bg-primary); padding-top: 0.5rem; padding-bottom: 0.5rem;
        }
        .doc-sidebar .doc-nav { overflow-y: auto; flex: 1; }
        .doc-nav-list { list-style: none; padding: 0; margin: 0; }
        .doc-nav-section {
            font-size: 0.8125rem; font-weight: 600; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 0.05em;
            padding: 0.5rem 0.8125rem; margin-top: 1rem;
        }
        .doc-nav-section:first-child { margin-top: 0; }
        .doc-nav-link {
            display: block; padding: 0.3125rem 0.8125rem; color: var(--text-primary);
            text-decoration: none; font-size: 0.875rem;
            border-left: 2px solid transparent; transition: all 0.2s ease;
        }
        .doc-nav-link:hover { color: var(--color-primary); background-color: var(--bg-secondary); }
        .doc-nav-link.active { color: var(--color-primary); border-left-color: var(--color-primary); font-weight: 500; }
        .doc-nav-link i { font-size: 1.1em; margin-right: 0.375rem; }
        @media (max-width: 991px) {
            .doc-nav { display: none; overflow-y: auto; flex: 1; max-height: calc(100vh - 200px); }
            .doc-nav.is-open { display: block; }
        }
        /* Quad-spinner styles now provided by framework (spinner.css) */
    </style>
</head>

<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <nav class="vd-navbar vd-navbar-fixed">
        <div class="vd-navbar-container">
            <div class="vd-navbar-brand">
                <a href="index.html"><i class="ph-fill ph-drop" style="color: var(--vd-color-primary); margin-right: 0.25em;"></i>Vanduo</a>
            </div>
            <button class="vd-navbar-toggle" aria-label="Toggle navigation"><span></span><span></span><span></span></button>
            <div class="vd-navbar-menu">
                <ul class="vd-navbar-nav">
                    <li><a href="index.html" class="vd-nav-link">Home</a></li>
                    <li><a href="documentation.html" class="vd-nav-link active">Documentation</a></li>
                    <li><a href="changelog.html" class="vd-nav-link">Changelog</a></li>
                    <li><a href="about.html" class="vd-nav-link">About</a></li>
                </ul>
                <button class="vd-theme-customizer-trigger" data-theme-customizer-trigger aria-label="Open theme customizer" style="margin-left: auto;">
                    <i class="ph ph-paint-roller"></i>
                </button>
            </div>
        </div>
    </nav>

    <main id="main-content" style="padding-top: 80px;">
        <div class="vd-container-responsive">
            <div class="doc-tabs">
                <a href="documentation.html" class="doc-tab"><i class="ph ph-cube"></i>Components</a>
                <a href="concepts.html" class="doc-tab"><i class="ph ph-lightbulb"></i>Concepts & Architecture</a>
                <a href="dynamic.html" class="doc-tab active"><i class="ph ph-lightning"></i>Dynamic Web</a>
            </div>

            <div class="vd-row">
                <aside class="vd-col-12 vd-col-lg-3 doc-sidebar">
                    <div class="vd-doc-search">
                        <div class="vd-doc-search-input-wrapper">
                            <i class="ph ph-magnifying-glass vd-doc-search-icon"></i>
                            <input type="search" class="vd-doc-search-input" placeholder="Search docs..."
                                aria-label="Search documentation" aria-controls="doc-search-results-list"
                                aria-expanded="false" autocomplete="off">
                            <kbd class="vd-doc-search-shortcut">&#231;K</kbd>
                        </div>
                        <div class="vd-doc-search-results" id="doc-search-results-list" role="listbox" aria-label="Search results"></div>
                    </div>
                    <nav class="doc-nav" aria-label="Documentation sections">
                        <ul class="doc-nav-list" id="dynamic-nav-list"></ul>
                    </nav>
                </aside>

                <div class="vd-col-12 vd-col-lg-9 doc-content" id="dynamic-content">
                    <!-- Preloaded Quick Start (getting-started) -->
                    <section id="getting-started">
                        <h2 class="demo-title"><i class="ph ph-rocket-launch"></i>Getting Started <code class="vd-text-sm">v1.1.5</code></h2>
                        <div class="vd-row">
                            <div class="vd-col-12 vd-mb-4">
                                <div class="vd-card vd-card-glow demo-card">
                                    <div class="vd-card-header"><h3><i class="ph ph-lightning mr-2" style="color: var(--color-warning);"></i>CDN (Fastest)</h3></div>
                                    <div class="vd-card-body">
                                        <p>Load directly from jsDelivr — no download required:</p>
                                        <pre class="code-example"><code>&lt;!-- CSS --&gt;
&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Nostromo-618/vanduo-framework@main/dist/vanduo.min.css"&gt;
&lt;!-- JS --&gt;
&lt;script src="https://cdn.jsdelivr.net/gh/Nostromo-618/vanduo-framework@main/dist/vanduo.min.js"&gt;&lt;/script&gt;
&lt;script&gt;Vanduo.init();&lt;/script&gt;</code></pre>
                                        <p class="vd-text-sm vd-text-muted vd-mt-3"><strong>Tip:</strong> Pin to a version for production: <code>@v1.1.5</code> instead of <code>@main</code></p>
                                    </div>
                                </div>
                            </div>
                            <div class="vd-col-12 vd-mb-4">
                                <div class="vd-card vd-card-glow demo-card">
                                    <div class="vd-card-header"><h3><i class="ph ph-download-simple mr-2" style="color: var(--color-primary);"></i>Download</h3></div>
                                    <div class="vd-card-body">
                                        <p><a href="https://github.com/Nostromo-618/vanduo-framework/tree/main/dist" target="_blank"><strong>Download the dist/ folder</strong></a> and include locally:</p>
                                        <pre class="code-example"><code>&lt;link rel="stylesheet" href="dist/vanduo.min.css"&gt;
&lt;script src="dist/vanduo.min.js"&gt;&lt;/script&gt;
&lt;script&gt;Vanduo.init();&lt;/script&gt;</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="vd-row">
                            <div class="vd-col-12 vd-col-md-6">
                                <div class="vd-card vd-card-glow demo-card">
                                    <div class="vd-card-header"><h3>JavaScript API</h3></div>
                                    <div class="vd-card-body">
                                        <p>After loading new content dynamically, re-initialize Vanduo:</p>
                                        <pre class="code-example"><code>Vanduo.destroyAllInContainer(container);  // optional: cleanup
container.innerHTML = html;
Vanduo.init();</code></pre>
                                    </div>
                                </div>
                            </div>
                            <div class="vd-col-12 vd-col-md-6">
                                <div class="vd-card vd-card-glow demo-card">
                                    <div class="vd-card-header"><h3>This page</h3></div>
                                    <div class="vd-card-body">
                                        <p>This <strong>Dynamic Web</strong> tab loads doc sections on demand. Click any item in the sidebar or search to load that section. No full page reload — pure vanilla JS, no third-party libs.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <footer class="vd-footer">
        <div class="vd-footer-container">
            <div class="vd-row">
                <div class="vd-col-12 vd-col-md-4">
                    <div class="vd-footer-section">
                        <h4>Vanduo Framework</h4>
                        <p>Essential just like water is.</p>
                        <p>Pure HTML, CSS, JS framework for beautiful static websites.</p>
                    </div>
                </div>
                <div class="vd-col-12 vd-col-md-4">
                    <div class="vd-footer-section">
                        <h4>Quick Links</h4>
                        <ul class="vd-footer-links">
                            <li><a href="index.html">Home</a></li>
                            <li><a href="documentation.html">Documentation</a></li>
                            <li><a href="changelog.html">Changelog</a></li>
                        </ul>
                    </div>
                </div>
                <div class="vd-col-12 vd-col-md-4">
                    <div class="vd-footer-section">
                        <h4>Resources</h4>
                        <ul class="vd-footer-links">
                            <li><a href="https://github.com/Nostromo-618/vanduo-framework">GitHub</a></li>
                            <li><a href="documentation.html">Documentation</a></li>
                            <li><a href="changelog.html">Changelog</a></li>
                            <li><a href="https://github.com/Nostromo-618/vanduo-framework/blob/main/LICENSE">License</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="vd-footer-bottom">
                <p class="vd-text-center vd-text-muted">&copy; 2026, Vanduo Framework. MIT License.</p>
            </div>
        </div>
    </footer>

    <script type="module">
        import { Vanduo } from './dist/vanduo.esm.min.js';
        Vanduo.init();

        const SECTIONS_BASE = './sections/';
        let sectionRegistry = { categories: [] };
        const loadedSections = new Set(['getting-started']);
        let searchInstance = null;
        let scrollSpyObserver = null;

        function getQuadSpinnerHtml() {
            return `<div class="vd-dynamic-loader">
                <div class="vd-dynamic-loader-grid">
                    <div class="vd-spinner vd-spinner-sm vd-spinner-success" style="animation-delay: 0s;"></div>
                    <div class="vd-spinner vd-spinner-sm vd-spinner-warning" style="animation-delay: -0.15s;"></div>
                    <div class="vd-spinner vd-spinner-sm vd-spinner-error" style="animation-delay: -0.3s;"></div>
                    <div class="vd-spinner vd-spinner-sm vd-spinner-info" style="animation-delay: -0.45s;"></div>
                </div>
                <span class="vd-dynamic-loader-text">Loading section...</span>
            </div>`;
        }

        function getLoadingPlaceholderHtml() {
            return `<div style="padding: 4rem 0; scroll-margin-top: 80px; border-bottom: 1px solid var(--border-color);">
                <div class="vd-skeleton-card" style="position: relative; min-height: 300px; padding: 2rem; overflow: hidden;">
                    <div class="vd-skeleton vd-skeleton-heading-lg" style="margin-bottom: 1.5rem;"></div>
                    <div class="vd-skeleton vd-skeleton-paragraph">
                        <div class="vd-skeleton vd-skeleton-text"></div>
                        <div class="vd-skeleton vd-skeleton-text"></div>
                        <div class="vd-skeleton vd-skeleton-text"></div>
                        <div class="vd-skeleton vd-skeleton-text"></div>
                    </div>
                    <div style="margin-top: 1.5rem;"></div>
                    <div class="vd-skeleton vd-skeleton-rect-sm" style="margin-bottom: 1.5rem;"></div>
                    <div class="vd-skeleton vd-skeleton-paragraph">
                        <div class="vd-skeleton vd-skeleton-text"></div>
                        <div class="vd-skeleton vd-skeleton-text"></div>
                    </div>
                    <div class="vd-dynamic-loader" style="position: absolute; inset: 0;">
                        <div class="vd-dynamic-loader-grid">
                            <div class="vd-spinner vd-spinner-sm vd-spinner-success" style="animation-delay: 0s;"></div>
                            <div class="vd-spinner vd-spinner-sm vd-spinner-warning" style="animation-delay: -0.15s;"></div>
                            <div class="vd-spinner vd-spinner-sm vd-spinner-error" style="animation-delay: -0.3s;"></div>
                            <div class="vd-spinner vd-spinner-sm vd-spinner-info" style="animation-delay: -0.45s;"></div>
                        </div>
                        <span class="vd-dynamic-loader-text">Loading section...</span>
                    </div>
                </div>
            </div>`;
        }

        function findSectionMeta(sectionId) {
            for (const cat of sectionRegistry.categories) {
                const sec = cat.sections.find(s => s.id === sectionId);
                if (sec) return { section: sec, category: cat.name };
            }
            return null;
        }

        async function loadSectionRegistry() {
            const res = await fetch(SECTIONS_BASE + 'sections.json');
            if (!res.ok) throw new Error('Failed to load sections.json');
            sectionRegistry = await res.json();
            const navList = document.getElementById('dynamic-nav-list');
            if (!navList) return;
            navList.innerHTML = '';
            sectionRegistry.categories.forEach(cat => {
                const liSec = document.createElement('li');
                liSec.className = 'doc-nav-section';
                liSec.textContent = cat.name;
                navList.appendChild(liSec);
                cat.sections.forEach(sec => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = '#' + sec.id;
                    a.className = 'doc-nav-link' + (sec.preload ? ' active' : '');
                    a.setAttribute('data-section', sec.id);
                    a.innerHTML = sec.icon ? '<i class="ph ' + sec.icon + ' mr-2"></i>' + sec.title : sec.title;
                    li.appendChild(a);
                    navList.appendChild(li);
                });
            });
        }

        async function loadSection(sectionId) {
            if (loadedSections.has(sectionId)) {
                const el = document.getElementById(sectionId);
                if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                setActiveNavLink(sectionId);
                return;
            }
            const meta = findSectionMeta(sectionId);
            if (!meta) return;
            const container = document.getElementById('dynamic-content');

            // 1. Create skeleton + spinner placeholder
            const placeholder = document.createElement('div');
            placeholder.id = 'dynamic-placeholder-' + sectionId;
            placeholder.innerHTML = getLoadingPlaceholderHtml();

            // 2. Insert placeholder at the correct ordered position
            const orderedIds = sectionRegistry.categories.flatMap(c => c.sections.map(s => s.id));
            const myIndex = orderedIds.indexOf(sectionId);
            let insertBeforeEl = null;
            for (let i = myIndex + 1; i < orderedIds.length; i++) {
                const existing = document.getElementById(orderedIds[i])
                    || document.getElementById('dynamic-placeholder-' + orderedIds[i]);
                if (existing) { insertBeforeEl = existing; break; }
            }
            if (insertBeforeEl) {
                container.insertBefore(placeholder, insertBeforeEl);
            } else {
                container.appendChild(placeholder);
            }

            // 3. Scroll to placeholder — user sees skeleton with spinner in place
            placeholder.scrollIntoView({ behavior: 'smooth', block: 'start' });
            setActiveNavLink(sectionId);

            try {
                const url = SECTIONS_BASE + meta.section.file;
                const res = await fetch(url);
                if (!res.ok) throw new Error('Failed to load ' + url);
                const html = await res.text();
                const wrap = document.createElement('div');
                wrap.innerHTML = html.trim();
                const sectionEl = wrap.firstElementChild;
                if (sectionEl) {
                    // 4. Replace placeholder with real content (same DOM position — no jump)
                    container.replaceChild(sectionEl, placeholder);
                    loadedSections.add(sectionId);
                    if (typeof Vanduo !== 'undefined') Vanduo.init();
                } else {
                    placeholder.remove();
                }
                setupScrollSpy();
                const target = document.getElementById(sectionId);
                if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                setActiveNavLink(sectionId);
                if (window.history && window.history.replaceState) {
                    window.history.replaceState(null, '', '#' + sectionId);
                }
            } catch (err) {
                placeholder.remove();
                console.error(err);
                container.insertAdjacentHTML('beforeend', '<div class="vd-alert vd-alert-error">Failed to load section. Check console.</div>');
            }
        }

        function setActiveNavLink(sectionId) {
            document.querySelectorAll('.doc-nav-link').forEach(link => {
                link.classList.toggle('active', link.getAttribute('data-section') === sectionId);
            });
        }

        function setupScrollSpy() {
            const navLinks = document.querySelectorAll('.doc-nav-link');
            const content = document.getElementById('dynamic-content');
            if (!content || !navLinks.length) return;
            if (scrollSpyObserver) scrollSpyObserver.disconnect();
            const sections = content.querySelectorAll('section[id]');
            scrollSpyObserver = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        setActiveNavLink(id);
                    }
                });
            }, { rootMargin: '-80px 0px -60% 0px', threshold: 0 });
            sections.forEach(sec => scrollSpyObserver.observe(sec));
        }

        function buildSearchData() {
            const data = [];
            sectionRegistry.categories.forEach(cat => {
                cat.sections.forEach(sec => {
                    data.push({
                        id: sec.id,
                        title: sec.title,
                        content: (sec.keywords || []).join(' '),
                        category: cat.name,
                        icon: sec.icon || ''
                    });
                });
            });
            return data;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await loadSectionRegistry();
            document.getElementById('dynamic-nav-list').addEventListener('click', e => {
                const link = e.target.closest('.doc-nav-link[data-section]');
                if (!link) return;
                e.preventDefault();
                const id = link.getAttribute('data-section');
                loadSection(id);
            });
            if (window.Search) {
                const searchData = buildSearchData();
                searchInstance = window.Search.init({
                    containerSelector: '.vd-doc-search',
                    inputSelector: '.vd-doc-search-input',
                    resultsSelector: '.vd-doc-search-results',
                    contentSelector: '#dynamic-content section[id]',
                    data: searchData,
                    onSelect: function(result) {
                        if (result && result.id) loadSection(result.id);
                    }
                });
            }
            setupScrollSpy();
            const hash = (location.hash || '').slice(1);
            if (hash && hash !== 'getting-started') loadSection(hash);
        });

        window.addEventListener('load', () => {
            const hash = (location.hash || '').slice(1);
            if (hash && !loadedSections.has(hash)) loadSection(hash).then(() => setupScrollSpy());
        });
    </script>
</body>
</html>
